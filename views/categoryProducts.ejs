<div class="container">
  <h1
    class="text-center"
    style="
      font-size: 100px;
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS',
        sans-serif;
      font-weight: 800;
      margin-top: -30px;
    "
  >
    <%= category.name %>
  </h1>
  <div class="sale-bar">
    <h6 style="padding: 0px 2%">OFERTAS</h6>
    <div class="owl-carousel owl-theme" style="padding: 10px">
      <% products.sort((a, b) => a.price - b.price).forEach((product) => { %>
      <div class="item">
        <div class="card border-0">
          <img
            src="/uploads/<%= product.image2 %>"
            alt=""
            class="card-img-top"
            height="150px"
          />
          <div
            class="card-body d-flex justify-content-between align-items-center"
          >
            <div class="d-flex flex-column">
              <span class="display-6" style="font-weight: 700"
                ><%= product.name%></span
              >
              <span
                class="display-6"
                style="font-size: 15px; color: #7f7e7c; font-weight: 400"
                ><%= product.description %></span
              >
              <span class="display-6">
                <p
                  class="btn btn-secondary"
                  style="border-radius: 0%; color: #c0c0c0"
                >
                  $<%= product.price %>
                </p></span
              >
            </div>
            <button
              class="btn btn-primary add-to-cart"
              data-id="<%= product.id %>"
              data-name="<%= product.name %>"
              data-price="<%= product.price %>"
            >
              <i
                style="color: white"
                class="fas fa-shopping-cart"
                title="Carrito"
              ></i>
            </button>
          </div>
        </div>
      </div>
      <% }) %>
    </div>
  </div>
  <br />
  <div class="categorycontainer">
    <% products.forEach((product) => { %>
    <a href="/product/<%= product.id %>">
      <div class="card">
        <img
          src="/uploads/<%= product.image1 %>"
          alt=""
          class="card-img-top"
          height="200px"
        />
        <div
          class="card-body d-flex align-items-center"
          style="text-align: center"
        >
          <% if (product.isNew) { %>
          <p class="btn btn-primary">Nuevo</p>
          <% } %>
          <p class="btn btn-secondary">$<%= product.price %></p>
          <p class="btn btn-success"><%= product.classification %></p>
        </div>
      </div>
    </a>
    <% }) %>
  </div>
</div>

<!-- Option 1: Bootstrap Bundle with Popper -->

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"
  integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw=="
  crossorigin="anonymous"
></script>
<script>
  $(".owl-carousel").owlCarousel({
    loop: true,
    margin: 40,
    nav: true,
    dots: false,
    navText: [
      "<h1 style='color: white'><</h1>",
      "<h1 style='color: white'>></h1>",
    ],
    responsive: {
      0: {
        items: 1,
      },
      600: {
        items: 2,
      },
      1000: {
        items: 4,
      },
    },
  });
  document.querySelectorAll(".add-to-cart").forEach((button) => {
    button.addEventListener("click", () => {
      const productId = button.dataset.id;
      const name = button.dataset.name;
      const price = button.dataset.price;

      fetch("/cart/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ productId, name, price }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            alert("Producto añadido al carrito");
          } else {
            alert("Hubo un error al añadir el producto");
          }
        });
    });
  });
</script>
